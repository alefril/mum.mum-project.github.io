<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <link rel="stylesheet" href="https://mum-project.github.io/docs/assets/css/main.css?id=3dc5e9742eba3b533695">
    <title>MUM Docs</title>
</head>
<body>
<div id="root" class="font-sans bg-white antialiased min-h-screen flex flex-col md:flex-row justify-center">
    <div class="w-full absolute bg-white pin-t pin-x z-30 h-16 border-b border-grey-lighter">
        <div class="flex flex-row items-center justify-between h-16 max-w-4xl px-2 w-full mx-auto">
            <div class="flex flex-row items-center text-grey-darker">
                <a href="https://mum-project.github.io/docs" class="mx-4 text-xl font-extrabold text-grey-dark no-underline hover:text-grey-darkest focus:text-grey-darkest">MUM</a>
                <div class="mx-4 text-grey-dark">v0.1.0</div>
            </div>
            <div class="flex flex-row items-center mx-4 text-grey-darker">
                <a href="https://github.com/mum-project/mum" target="_blank" rel="noreferrer noopener" class="mx-4 text-grey-dark hover:text-grey-darker focus:text-grey-darker">
                    <svg class="fill-current w-5 h-5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"><title>
                            GitHub</title>
                        <path d="M10 0a10 10 0 0 0-3.16 19.49c.5.1.68-.22.68-.48l-.01-1.7c-2.78.6-3.37-1.34-3.37-1.34-.46-1.16-1.11-1.47-1.11-1.47-.9-.62.07-.6.07-.6 1 .07 1.53 1.03 1.53 1.03.9 1.52 2.34 1.08 2.91.83.1-.65.35-1.09.63-1.34-2.22-.25-4.55-1.11-4.55-4.94 0-1.1.39-1.99 1.03-2.69a3.6 3.6 0 0 1 .1-2.64s.84-.27 2.75 1.02a9.58 9.58 0 0 1 5 0c1.91-1.3 2.75-1.02 2.75-1.02.55 1.37.2 2.4.1 2.64.64.7 1.03 1.6 1.03 2.69 0 3.84-2.34 4.68-4.57 4.93.36.31.68.92.68 1.85l-.01 2.75c0 .26.18.58.69.48A10 10 0 0 0 10 0"></path>
                    </svg>
                </a>
            </div>
        </div>
    </div>
    <div class="pt-16 flex flex-col min-h-screen md:flex-row w-full max-w-4xl justify-center z-20">
        <div class="text-grey-darker md:w-64 flex flex-col z-20 relative h-full">
    <div class="sticky pin-t flex flex-col md:overflow-y-auto md:w-64 truncate">
                    <div class="mt-6 mb-2 px-6 text-grey uppercase tracking-wide font-bold text-xs">Introduction</div>
                            <a class="text-grey-darker px-6 mb-1 py-1 text-sm no-underline hover:text-black focus:text-black truncate"
                   href="https://mum-project.github.io/docs/what-is-mum"
                >
                    What is MUM
                </a>
                                <div class="mt-6 mb-2 px-6 text-grey uppercase tracking-wide font-bold text-xs">Getting Started</div>
                            <a class="text-grey-darker px-6 mb-1 py-1 text-sm no-underline hover:text-black focus:text-black truncate"
                   href="https://mum-project.github.io/docs/installation"
                >
                    Installation
                </a>
                            <a class="text-blue-dark font-semibold px-6 mb-1 py-1 text-sm no-underline hover:text-black focus:text-black truncate"
                   href="https://mum-project.github.io/docs/debian-installation-guide"
                >
                    Debian Installation Guide
                </a>
                            <a class="text-grey-darker px-6 mb-1 py-1 text-sm no-underline hover:text-black focus:text-black truncate"
                   href="https://mum-project.github.io/docs/postfix-and-dovecot"
                >
                    Postfix and Dovecot
                </a>
                            <a class="text-grey-darker px-6 mb-1 py-1 text-sm no-underline hover:text-black focus:text-black truncate"
                   href="https://mum-project.github.io/docs/configuration-options"
                >
                    Configuration Options
                </a>
                        </div>
</div>        <div class="sm:px-3 flex flex-col flex-grow items-center z-10">
            <div class="markdown px-6 py-2 mb-8 w-full flex-grow max-w-lg">
                <div class="mt-6 mb-6">
                    <h1 class="font-extrabold mb-3">Debian Installation Guide</h1>
                                    </div>
                <div class="py-3 pl-4 pr-4 my-4 bg-blue text-white rounded flex flex-row items-start">
    <div class="text-white mr-4">
        <svg class="w-8 h-8 fill-current" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" width="24" height="24"><path class="heroicon-ui" d="M12 22a10 10 0 1 1 0-20 10 10 0 0 1 0 20zm0-2a8 8 0 1 0 0-16 8 8 0 0 0 0 16zm0-9a1 1 0 0 1 1 1v4a1 1 0 0 1-2 0v-4a1 1 0 0 1 1-1zm0-4a1 1 0 1 1 0 2 1 1 0 0 1 0-2z"></path></svg></div>
    <div class="leading-normal">
        <div class="flex-grow flex flex-col">
        <div class="font-bold mb-1">Work in progress</div>
        <p class="text-sm">Not all information is included in the docs yet, but we are working on it!</p>
    </div>
    </div>
</div>
<p>We know setting up servers can be hard and frustrating. Hopefully, this guide helps you step by step along the way.
We assume your server is running <strong>Debian Stretch</strong> and does not have any of the necessary tools installed.
If you have a working PHP 7.2 webserver setup, please jump to the <a href="#installing-mum">Installing MUM</a> section.</p>
<h2>Prerequisites</h2>
<p>Make sure your system is up-to-date and you have installed the following packages:</p>
<div class="rounded my-2 p-4 bg-grey-lightest">
    <pre class="language-bash" style="margin: 0; padding: 0;"><code>sudo apt-get update &amp;&amp; sudo apt-get upgrade
sudo apt-get install unzip curl wget acl git</code></pre>
</div>
<h2>Installing PHP 7.2</h2>
<p>Since Debian Stretch only ships with PHP 7.0 (as of 2018), we have to install a new package repository that allows
us to download newer versions of PHP. The following commands should be executed with root privileges
(use <code>sudo</code> or login with user <code>root</code>).</p>
<div class="rounded my-2 p-4 bg-grey-lightest">
    <pre class="language-bash" style="margin: 0; padding: 0;"><code>sudo apt-get -y install apt-transport-https lsb-release ca-certificates
sudo wget -O /etc/apt/trusted.gpg.d/php.gpg https://packages.sury.org/php/apt.gpg
sudo sh -c 'echo "deb https://packages.sury.org/php/ $(lsb_release -sc) main" &gt; /etc/apt/sources.list.d/php.list'
sudo apt-get update</code></pre>
</div>
<p>The next step is to actually install PHP and all necessary extensions.
The following commands should be executed with root privileges (use <code>sudo</code> or login with user <code>root</code>).</p>
<div class="rounded my-2 p-4 bg-grey-lightest">
    <pre class="language-bash" style="margin: 0; padding: 0;"><code>sudo apt-get install php7.2 php7.2-mbstring php7.2-xml php7.2-zip \
php7.2-cli php7.2-common php7.2-curl php7.2-json php7.2-mysql php7.2-opcache</code></pre>
</div>
<p>Now, when you execute <code>php -v</code> you should see something like</p>
<div class="rounded my-2 p-4 bg-grey-lightest">
    <pre class="language-html" style="margin: 0; padding: 0;"><code>PHP 7.2.8-1+0~20180725124257.2+stretch~1.gbp571e56 (cli) (built: Jul 25 2018 12:43:00) ( NTS )
Copyright (c) 1997-2018 The PHP Group
Zend Engine v3.2.0, Copyright (c) 1998-2018 Zend Technologies
    with Zend OPcache v7.2.8-1+0~20180725124257.2+stretch~1.gbp571e56, Copyright (c) 1999-2018, by Zend Technologies</code></pre>
</div>
<h2>Installing MySQL / MariaDB</h2>
<p>Firstly, we need to install a database server. We are going to use MariaDB here.</p>
<div class="rounded my-2 p-4 bg-grey-lightest">
    <pre class="language-bash" style="margin: 0; padding: 0;"><code>sudo apt-get install mariadb-server
sudo mysql -u root</code></pre>
</div>
<p>The last command opened a MySQL shell. Now, we need to create the database and several users.
Please choose <strong>secure</strong> passwords for your users. <a href="https://www.eff.org/dice">Diceware</a> is one way of
generating secure passwords that are easily typeable and memorable.</p>
<div class="rounded my-2 p-4 bg-grey-lightest">
    <pre class="language-sql" style="margin: 0; padding: 0;"><code>CREATE USER mum@localhost IDENTIFIED BY 'my_secure_password_1';
CREATE USER mum_postfix@localhost IDENTIFIED BY 'my_secure_password_2';
CREATE USER mum_dovecot@localhost IDENTIFIED BY 'my_secure_password_3';
CREATE DATABASE mum;
GRANT ALL PRIVILEGES ON mum.* TO mum@localhost;
GRANT SELECT ON mum.* TO mum_postfix@localhost;
GRANT SELECT ON mum.* TO mum_dovecot@localhost;</code></pre>
</div>
<p>To exit the MySQL shell, simply type <code>exit;</code>.</p>
<h2>Configuring Apache2</h2>
<p>When installing the <code>php7.2</code> package, the <code>apache2</code> should have automatically been installed as well.
To check if Apache2 is running, execute <code>sudo service apache2 status</code>.
If the service is running, you can continue with your Apache2 configuration. If the service could not be found,
install it with <code>sudo apt-get install apache2</code>.</p>
<h3>Enabling Modules</h3>
<p>The first thing we need to do is to enable a few Apache2 modules that we need. The module <code>ssl</code> is needed for HTTPS,
<code>headers</code> is needed to configure <a href="https://en.wikipedia.org/wiki/HTTP_Strict_Transport_Security">HSTS</a> on our
virtual host and <code>rewrite</code> is needed to redirect clients from HTTP to HTTPS, so that all traffic will be encrypted.</p>
<div class="rounded my-2 p-4 bg-grey-lightest">
    <pre class="language-bash" style="margin: 0; padding: 0;"><code>sudo a2enmod ssl headers rewrite php7.2
sudo service apache2 restart</code></pre>
</div>
<h3>SSL/TLS Configuration</h3>
<p>We want MUM to (only) be available via HTTPS so that any traffic between your browser and MUM is encrypted.
If your server is accessible from the internet, the easiest (and a free) way to get an SSL certificate is
to use <a href="https://letsencrypt.org/">Let's Encrypt</a>. Follow the <a href="https://certbot.eff.org/">instructions for EFF's Certbot</a>
on how to obtain a free SSL certificate through Let's Encrypt. From here on out we are going to assume that
you are using a Let's Encrypt SSL certificate. If you choose to work with a different certificate, please
change your file paths in the following configuration files accordingly.</p>
<h3>Virtual Host Configuration</h3>
<p>The first step is to create a configuration file for the domain that should serve MUM's web interface.
We are going to use <code>mum.example.com</code> here, please change that name to your domain.</p>
<div class="rounded my-2 p-4 bg-grey-lightest">
    <pre class="language-bash" style="margin: 0; padding: 0;"><code>sudo nano /etc/apache2/sites-available/mum.example.com.conf</code></pre>
</div>
<p>Inside this configuration file we need to specify a virtual host that listens on port 443.
<code>ServerName</code> is the domain where MUM's web interface will be served. <code>DocumentRoot</code> is the path to MUM's
<code>public</code> folder. We are going to clone MUM into <code>/var/www/</code>, but you could use any path you want.
If you don't use Certbot with Let's Encrypt certificates, you will probably need to adjust the paths for
<code>SSLCertificateFile</code> and <code>SSLCertificateKeyFile</code>.</p>
<div class="rounded my-3 overflow-hidden bg-grey-lightest">
    <div class="bg-grey-dark text-white px-4 py-2 text-sm text-right font-mono">
        /etc/apache2/sites-available/mum.example.com.conf
    </div>
    <pre class="m-0 p-4 language-apacheconf"><code>&lt;VirtualHost *:443&gt;
    ServerName mum.example.com
    DocumentRoot /var/www/mum/public
    &lt;Directory /var/www/mum/public&gt;
        Options -Indexes +FollowSymLinks +MultiViews
        AllowOverride All
        Require all granted
    &lt;/Directory&gt;
    SSLCertificateFile /etc/letsencrypt/live/mum.example.com/fullchain.pem
    SSLCertificateKeyFile /etc/letsencrypt/live/mum.example.com/privkey.pem

    SSLEngine on
    SSLProtocol All -SSLv2 -SSLv3
    SSLHonorCipherOrder On
    SSLCompression off
    Header always set Strict-Transport-Security "max-age=15768000"
    SSLCipherSuite 'EDH+CAMELLIA:EDH+aRSA:EECDH+aRSA+AESGCM:EECDH+aRSA+SHA256:EECDH:+CAMELLIA128:+AES128:+SSLv3:!aNULL:!eNULL:!LOW:!3DES:!MD5:!EXP:!PSK:!DSS:!RC4:!SEED:!IDEA:!ECDSA:kEDH:CAMELLIA128-SHA:AES128-SHA'
&lt;/VirtualHost&gt;</code></pre>
</div>
<p>Now we need to redirect all clients that use HTTP on port 80 to HTTPS on port 443.
To do that, you could either add a second <code>VirtualHost</code> definition in your configuration file or create a second
file that only holds your HTTP host(s). If you want to redirect HTTP traffic for all your virtual hosts,
leave out the <code>ServerName</code> directive.</p>
<div class="rounded my-3 overflow-hidden bg-grey-lightest">
    <div class="bg-grey-dark text-white px-4 py-2 text-sm text-right font-mono">
        /etc/apache2/sites-available/mum.example.com-http.conf
    </div>
    <pre class="m-0 p-4 language-apacheconf"><code>&lt;VirtualHost *:80&gt;
    ServerName mum.example.com
    RewriteEngine On
    RewriteCond %{HTTPS} off
    RewriteRule ^ https://%{SERVER_NAME}%{REQUEST_URI} [END,QSA,R=permanent]
&lt;/VirtualHost&gt;</code></pre>
</div>
<p>The last step is to enable the new VirtualHost in Apache2. Please use your actual domain
or rather the name of your <code>.conf</code> file. What this command does is to create a symbolic
link from <code>/etc/sites-enabled/mum.example.com.conf</code> to <code>/etc/sites-available/mum.example.com.conf</code>.</p>
<div class="rounded my-2 p-4 bg-grey-lightest">
    <pre class="language-bash" style="margin: 0; padding: 0;"><code>sudo a2ensite mum.example.com</code></pre>
</div>
<h2>Installing Composer</h2>
<p>The next thing we need is the PHP dependency manager <a href="https://getcomposer.org/">Composer</a>.
To install Composer, please follow the <a href="https://getcomposer.org/download/">instructions on how to install the latest version</a>.
If you want to install Composer globally, execute the following line after you executed the installer script:</p>
<div class="rounded my-2 p-4 bg-grey-lightest">
    <pre class="language-bash" style="margin: 0; padding: 0;"><code>sudo mv composer.phar /usr/local/bin/composer</code></pre>
</div>
<h2>Installing MUM</h2>
<p>Now on to the important part: actually installing MUM. The first thing you'll want to do is clone the repository
to your local machine, we are going to clone it into <code>/var/www/mum/</code>, but you could use any folder you want.
Just make sure you adjust your Apache2 configuration accordingly.</p>
<p>After cloning the repository, we will install all PHP dependencies. Then, we will create a configuration file
for your local settings called <code>.env</code>. Refer to our <a href="https://mum-project.github.io/docs/configuration-options">configuration options</a>
for more information on this file. Next, we will generate an encryption key for MUM to use.</p>
<div class="rounded my-2 p-4 bg-grey-lightest">
    <pre class="language-bash" style="margin: 0; padding: 0;"><code>cd /var/www/
sudo mkdir mum &amp;&amp; sudo chown user:user mum
git clone https://github.com/mum-project/mum.git
cd mum
composer install
cp .env.example .env
php artisan key:generate</code></pre>
</div>
<p>After these steps, your <code>mum</code> folder and it's permissions should look something like this:</p>
<div class="rounded my-2 p-4 bg-grey-lightest">
    <pre class="language-bash" style="margin: 0; padding: 0;"><code>user@debian:/var/www/mum$ ls -la
...
-rw-r--r--  1 user user   1965 Jul 31 12:38 .env
...
drwxr-xr-x  5 user user   4096 Jul 31 12:38 storage
...</code></pre>
</div>
<p>Finally, we need to give Apache2's <code>www-data</code> user permissions to read, write and execute for the <code>storage</code> folder
and all files within. Since we installed the <code>acl</code> package earlier, we can use <code>setfacl</code> to set default permissions
for the user <code>www-data</code> and our own user <code>user</code>. Be sure to use your actual user name here.</p>
<div class="rounded my-2 p-4 bg-grey-lightest">
    <pre class="language-bash" style="margin: 0; padding: 0;"><code>sudo setfacl -R -m u:www-data:rwx storage/
sudo setfacl -R -m u:user:rwx storage/
sudo setfacl -d -R -m u:www-data:rwx storage/
sudo setfacl -d -R -m u:user:rwx storage/</code></pre>
</div>
<p>The command <code>getfacl</code> now should output something like:</p>
<div class="rounded my-2 p-4 bg-grey-lightest">
    <pre class="language-bash" style="margin: 0; padding: 0;"><code>user@debian:/var/www/mum$ getfacl storage/
...
user:www-data:rwx
user:user:rwx
...
default:user::rwx
default:user:www-data:rwx
default:user:user:rwx
...</code></pre>
</div>
<h2>Configuring MUM</h2>
<p>The last step is to configure MUM's <code>.env</code> file to suit your environment. Please see our
<a href="https://mum-project.github.io/docs/configuration-options">page on configuration options</a> for details.
One thing you surely need to configure are the mysql credentials. Be sure to use the actual credentials
you used when creating the database users in the <a href="#installing-mysql-mariadb">MySQL section</a>.</p>
<div class="rounded my-3 overflow-hidden bg-grey-lightest">
    <div class="bg-grey-dark text-white px-4 py-2 text-sm text-right font-mono">
        /var/www/mum/.env
    </div>
    <pre class="m-0 p-4 language-text"><code>DB_CONNECTION=mysql
DB_HOST=127.0.0.1
DB_PORT=3306
DB_DATABASE=mum
DB_USERNAME=mum
DB_PASSWORD=my_secret_password_1</code></pre>
</div>
<p>Another important step is to migrate the database. That means we are going to create the
necessary tables in our database.</p>
<div class="rounded my-2 p-4 bg-grey-lightest">
    <pre class="language-bash" style="margin: 0; padding: 0;"><code>php artisan migrate</code></pre>
</div>
<h2>Creating Your First User</h2>
<p>Since MUM does not have a web installer yet, you will need to use console commands to create your first user in MUM.
Use the following commands to create a domain and a super admin mailbox:</p>
<div class="rounded my-2 p-4 bg-grey-lightest">
    <pre class="language-bash" style="margin: 0; padding: 0;"><code>php artisan domains:create example.com
php artisan mailboxes:create admin example.com --super_admin --name='Super Admin'</code></pre>
</div>
<p>For a full list of command options, use the <code>--help</code> flag with the commands:</p>
<div class="rounded my-2 p-4 bg-grey-lightest">
    <pre class="language-bash" style="margin: 0; padding: 0;"><code>$ php artisan domains:create --help
Usage:
  domains:create [options] [--] &lt;domain&gt;

Arguments:
  domain                               Domain to create, eg. example.com

Options:
      --description[=DESCRIPTION]
      --quota[=QUOTA]
      --max_quota[=MAX_QUOTA]
      --max_aliases[=MAX_ALIASES]
      --max_mailboxes[=MAX_MAILBOXES]
  -h, --help                           Display this help message
  -q, --quiet                          Do not output any message
  -V, --version                        Display this application version
      --ansi                           Force ANSI output
      --no-ansi                        Disable ANSI output
  -n, --no-interaction                 Do not ask any interactive question
      --env[=ENV]                      The environment the command should run under
  -v|vv|vvv, --verbose                 Increase the verbosity of messages: 1 for normal output, 2 for more verbose output and 3 for debug

Help:
  Create a new domain. ATTENTION: This command currently does not perform ANY validation of supplied data.</code></pre>
</div>
<div class="rounded my-2 p-4 bg-grey-lightest">
    <pre class="language-bash" style="margin: 0; padding: 0;"><code>$ php artisan mailboxes:create --help
Usage:
  mailboxes:create [options] [--] &lt;local_part&gt; &lt;domain&gt;

Arguments:
  local_part                                   The local part of the email address
  domain                                       An existing domain in MUM

Options:
      --password[=PASSWORD]                    You are asked for a password if you don't supply this option. Be aware that the value of the password option may be recorded in your shell history.
      --name[=NAME]                            The name of the person that uses the mailbox
      --alternative_email[=ALTERNATIVE_EMAIL]  An alternative address that may be used to reset the password
      --quota[=QUOTA]                          Maximum disk space for emails in GB
      --send_only                              Whether the mailbox should be able to receive emails, defaults to false
      --inactive                               Whether the mailbox should be inactive, defaults to false
      --super_admin                            Whether the mailbox should be a super admin, defaults to false
  -h, --help                                   Display this help message
  -q, --quiet                                  Do not output any message
  -V, --version                                Display this application version
      --ansi                                   Force ANSI output
      --no-ansi                                Disable ANSI output
  -n, --no-interaction                         Do not ask any interactive question
      --env[=ENV]                              The environment the command should run under
  -v|vv|vvv, --verbose                         Increase the verbosity of messages: 1 for normal output, 2 for more verbose output and 3 for debug

Help:
  Create a new mailbox. ATTENTION: This command currently does not perform ANY validation of supplied data.</code></pre>
</div>
<h2>Troubleshooting</h2>
<p>Whether you see an error message or nothing at all - it is always a good idea to have a look in your log files.
We hope the following tips will help you to solve your problem. If you have a new tip, we'd love to hear from you!</p>
<h4>Invalid Cache Path</h4>
<p>The Apache2 error logs show a PHP error along the lines of:</p>
<div class="rounded my-3 overflow-hidden bg-grey-lightest">
    <div class="bg-grey-dark text-white px-4 py-2 text-sm text-right font-mono">
        /var/www/apache2/error.log
    </div>
    <pre class="m-0 p-4 language-text"><code>... Uncaught InvalidArgumentException: Please provide a valid cache path. ...</code></pre>
</div>
<p>Sometimes it helps to clear all caches with <code>php artisan cache:clear &amp;&amp; php artisan config:clear &amp;&amp; php artisan view:clear</code>.
If the error keeps happening, you probably haven't set the <code>storage</code> folder permissions correctly.</p>
<hr />
<p>If you think you have spotted an error in this guide, please check if other people spotted it too by looking at
the <a href="https://github.com/mum-project/docs/issues">GitHub issues in our docs repository</a> first. If you are first,
we would highly appreciate if you told us by opening a new issue or (even better) a pull request.</p>            </div>
        </div>
        <div class="text-grey-darker md:w-64 h-full flex flex-col z-20">
    <div class="sticky pin-t md:flex flex-col md:w-64 truncate">
        <div class="py-6 md:overflow-hidden md:overflow-y-auto">
            <table-of-contents></table-of-contents>
        </div>
    </div>
</div>
    </div>
</div>
<script src="https://mum-project.github.io/docs/assets/js/prism.js"></script>
<script src="https://mum-project.github.io/docs/assets/js/main.js?id=1f369b8bb3c56531e390"></script>
</body>
</html>
